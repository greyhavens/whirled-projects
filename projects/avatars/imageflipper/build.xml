<!-- build configuration -->
<project name="ImageFlipper" default="all" basedir=".">

  <!-- define some basic project parameters -->
  <property name="app.name"         value="ImageFlipper"/>
  <property name="root.path"        value="../../../.."/>
  <property name="flex.path"        value="${root.path}/tools/extern/flex_sdk"/>

  <target name="useAssets1">
    <copy file="RemixAssets1.as" tofile="RemixAssets.as" overwrite="true"/>
  </target>

  <target name="useAssets2">
    <copy file="RemixAssets2.as" tofile="RemixAssets.as" overwrite="true"/>
  </target>

  <target name="useAssets3">
    <copy file="RemixAssets3.as" tofile="RemixAssets.as" overwrite="true"/>
  </target>

  <!-- builds our Flash game -->
  <target name="compile" depends="useAssets1">
    <java jar="${flex.path}/lib/mxmlc.jar" fork="true" failonerror="true">
      <arg value="-load-config"/>
      <arg value="${root.path}/etc/msoy-config.xml"/>
      <arg value="-compiler.source-path=."/>
      <arg value="-file-specs"/>
      <arg value="${app.name}.as"/>
    </java>
  </target>

  <target name="preloader" depends="useAssets2">
    <java jar="${flex.path}/lib/mxmlc.jar" fork="true" failonerror="true">
      <arg value="-load-config"/>
      <arg value="${root.path}/etc/msoy-config.xml"/>
      <arg value="-compiler.source-path=."/>
      <arg value="-includes"/>
      <arg value="RemixAssets"/>

      <arg value="-link-report"/>
      <arg value="/tmp/link-report.txt"/>
      <arg value="-file-specs"/>
      <arg value="PreLoader.as"/>
    </java>
  </target>

  <!-- this may be used to strip original assets out of the logic SWF. -->
  <target name="rework" depends="useAssets3">
    <java jar="${flex.path}/lib/mxmlc.jar" fork="true" failonerror="true">
      <arg value="-load-config"/>
      <arg value="${root.path}/etc/msoy-config.xml"/>
      <arg value="-compiler.source-path=."/>
      <arg value="-includes"/>
      <arg value="RemixAssets"/>

      <arg value="-link-report"/>
      <arg value="/tmp/link-report.txt"/>
      <arg value="-file-specs"/>
      <arg value="ReWorker.as"/>
    </java>
  </target>

  <target name="all" depends="compile, preloader"/>

  <!-- cleans out the compiled code -->
  <target name="clean">
    <delete>
       <fileset file="${app.name}.swf"/>
    </delete>
  </target>

  <target name="dist" depends="compile">
    <copy file="${app.name}.swf" tofile="/export/msoy/pages/media/6c015e7cf97af6418ca304acd0128d27ad4913f5.swf"/>
  </target>

  <target name="dist2" depends="preloader">
    <copy file="PreLoader.swf" tofile="/export/msoy/pages/media/515a24b7cc90db25bf629560c57aebd8725ce242.swf"/>
  </target>

  <target name="distall" depends="dist, dist2"/>

</project>
