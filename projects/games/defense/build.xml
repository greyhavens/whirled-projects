<!-- build configuration -->
<project name="defense" default="compile" basedir=".">

  <!-- define some basic project parameters -->
  <property name="app.name" value="Defense"/>
  <property name="app.source-suffix" value="mxml"/>
  <property name="app.source-dir" value="src"/>
  <property name="app.package-dir" value="com/threerings/defense"/>

  <!-- include the standard build script -->
  <import file="../../../etc/project-include.xml"/>

  <!-- compiles and then jams the SWF into the document tree with the right filename -->
  <property name="media_hash" value="cfe291b493d9974d3fe3518ea454ae7f46cb6732"/>
  <target name="dist" depends="compile">
    <copy file="${app.name}.swf" tofile="/export/msoy/pages/media/${media_hash}.swf"/>
  </target>

  <!-- builds our benchmarking tool -->
  <property name="bench.name" value="Bench"/>
  <property name="bench.package-dir" value="com/threerings/benchmark"/>
  <target name="benchmark" depends="prepare-flex,buildtop">
    <java jar="${flex.path}/lib/mxmlc.jar" fork="true" failonerror="true">
      <arg value="-load-config"/>
      <arg value="${etc.dir}/whirled-config.xml"/>
      <arg value="-library-path+=${app.library-dir}"/>
      <arg value="-use-network=${flex.use-network}"/>
      <arg value="-compiler.source-path=${app.source-dir}"/>
      <arg value="-file-specs"/>
      <arg value="${app.source-dir}/${bench.package-dir}/${bench.name}.${app.source-suffix}"/>
      <arg value="-output"/>
      <arg value="${bench.name}.swf"/>
    </java>
  </target>

  <!-- builds the display benchmarks -->
  <property name="dispbench.name" value="DispBench"/>
  <property name="dispbench.package-dir" value="com/threerings/benchmark/display"/>
  <target name="dispbenchmark" depends="prepare-flex,buildtop">
    <java jar="${flex.path}/lib/mxmlc.jar" fork="true" failonerror="true">
      <arg value="-load-config"/>
      <arg value="${etc.dir}/whirled-config.xml"/>
      <arg value="-library-path+=${app.library-dir}"/>
      <arg value="-use-network=${flex.use-network}"/>
      <arg value="-compiler.source-path=${app.source-dir}"/>
      <arg value="-file-specs"/>
      <arg value="${app.source-dir}/${dispbench.package-dir}/${dispbench.name}.${app.source-suffix}"/>
      <arg value="-output"/>
      <arg value="${dispbench.name}.swf"/>
    </java>
  </target>

</project>

